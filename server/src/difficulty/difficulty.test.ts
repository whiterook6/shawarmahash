import { describe, it } from "node:test";
import { Difficulty } from "./difficulty";
import expect from "expect";
import { Chain } from "../chain/chain";

describe("Difficulty", () => {
  describe("buildDifficultyTarget", () => {
    it("Builds difficulty targets in order", () => {
      let previousDifficultyTarget = "00000000000000000000000000000000";
      for (let i = 0; i <= 64; i += 0.05) {
        const difficultyTarget = Difficulty.buildDifficultyTarget(i);
        expect(difficultyTarget >= previousDifficultyTarget).toBe(true);
        previousDifficultyTarget = difficultyTarget;
      }

      const allTargets = Array.from({ length: 64 }, (_, i) =>
        Difficulty.buildDifficultyTarget(i),
      );
      const sortedTargets = allTargets.sort((a, b) => a.localeCompare(b));
      expect(sortedTargets).toEqual(allTargets);
    });
  });

  describe("getDifficultyFromHash", () => {
    it("Can get the difficulty from a hash", () => {
      for (let i = 0; i <= 32; i += 0.05) {
        const difficultyTarget = Difficulty.buildDifficultyTarget(i);
        const difficulty = Difficulty.getDifficultyFromHash(difficultyTarget);
        const difference = Math.abs(difficulty - i);
        expect(difference).toBeLessThanOrEqual(0.1);
      }
    });
  });

  describe("getDifficultySliceFromChain", () => {
    const chainSubset = [
      {
        hash: "fffff91a07ffcee9594b7c6246751743",
        previousHash: "fffffce307736679c6a4560f05b630fc",
        player: "TIM",
        team: "TST",
        timestamp: 1769150704,
        nonce: 1416417,
        index: 585,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff4aaf1888453bc46739860da6a73",
        previousHash: "fffff91a07ffcee9594b7c6246751743",
        player: "TIM",
        team: "TST",
        timestamp: 1769150707,
        nonce: 878185,
        index: 586,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffbb5caace971b79f810a7b140690",
        previousHash: "fffff4aaf1888453bc46739860da6a73",
        player: "TIM",
        team: "TST",
        timestamp: 1769150718,
        nonce: 1315145,
        index: 587,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffa780c875bd12a0b6514b4db8e14",
        previousHash: "fffffbb5caace971b79f810a7b140690",
        player: "TIM",
        team: "TST",
        timestamp: 1769150736,
        nonce: 2497478,
        index: 588,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffdab290d5a6cdaab9cca73e8fb28",
        previousHash: "fffffa780c875bd12a0b6514b4db8e14",
        player: "TIM",
        team: "TST",
        timestamp: 1769150749,
        nonce: 1604683,
        index: 589,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff28a52d3ce99c143067878049a82",
        previousHash: "fffffdab290d5a6cdaab9cca73e8fb28",
        player: "TIM",
        team: "TST",
        timestamp: 1769150756,
        nonce: 878808,
        index: 590,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff3e3c3c70ae0828bc417755a1cc7",
        previousHash: "fffff28a52d3ce99c143067878049a82",
        player: "TIM",
        team: "TST",
        timestamp: 1769150779,
        nonce: 2805062,
        index: 591,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff03574f7706dadea63386cde5fed",
        previousHash: "fffff3e3c3c70ae0828bc417755a1cc7",
        player: "TIM",
        team: "TST",
        timestamp: 1769150787,
        nonce: 886178,
        index: 592,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff253397e613dd3db9b17ab42e570",
        previousHash: "fffff03574f7706dadea63386cde5fed",
        player: "TIM",
        team: "TST",
        timestamp: 1769150802,
        nonce: 1831375,
        index: 593,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff8d5fa122025008ccc7396f07a94",
        previousHash: "fffff253397e613dd3db9b17ab42e570",
        player: "TIM",
        team: "TST",
        timestamp: 1769150810,
        nonce: 770412,
        index: 594,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "ffffff3b2de7596cf2913bf43ce136a2",
        previousHash: "fffff8d5fa122025008ccc7396f07a94",
        player: "TIM",
        team: "TST",
        timestamp: 1769150816,
        nonce: 1151172,
        index: 595,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff3252c81928cf3a2129d575e1ae2",
        previousHash: "ffffff3b2de7596cf2913bf43ce136a2",
        player: "TIM",
        team: "TST",
        timestamp: 1769150854,
        nonce: 3817081,
        index: 596,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffeb13a9839d0ceb8d70f9b113067",
        previousHash: "fffff3252c81928cf3a2129d575e1ae2",
        player: "TIM",
        team: "TST",
        timestamp: 1769150854,
        nonce: 50356,
        index: 597,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff2ed8c91a2f36da453743e7d07c9",
        previousHash: "fffffeb13a9839d0ceb8d70f9b113067",
        player: "TIM",
        team: "TST",
        timestamp: 1769150856,
        nonce: 255118,
        index: 598,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffb63887c2cd1bd546a41237af256",
        previousHash: "fffff2ed8c91a2f36da453743e7d07c9",
        player: "TIM",
        team: "TST",
        timestamp: 1769150859,
        nonce: 459764,
        index: 599,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff9d1910da0ee3286ef8695cfb996",
        previousHash: "fffffb63887c2cd1bd546a41237af256",
        player: "TIM",
        team: "TST",
        timestamp: 1769150864,
        nonce: 930059,
        index: 600,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff26d0dc92baf0f5b49df940030c6",
        previousHash: "fffff9d1910da0ee3286ef8695cfb996",
        player: "TIM",
        team: "TST",
        timestamp: 1769150864,
        nonce: 211389,
        index: 601,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff6ff66132048be13ee82ed026a6d",
        previousHash: "fffff26d0dc92baf0f5b49df940030c6",
        player: "TIM",
        team: "TST",
        timestamp: 1769150867,
        nonce: 896391,
        index: 602,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff83e4a566f41890760e4666664f6",
        previousHash: "fffff6ff66132048be13ee82ed026a6d",
        player: "TIM",
        team: "TST",
        timestamp: 1769150908,
        nonce: 4671121,
        index: 603,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff8db809fd680bfec4b506786e15f",
        previousHash: "fffff83e4a566f41890760e4666664f6",
        player: "TIM",
        team: "TST",
        timestamp: 1769150921,
        nonce: 2123706,
        index: 604,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff185fb24b425891ea775a8338729",
        previousHash: "fffff8db809fd680bfec4b506786e15f",
        player: "TIM",
        team: "TST",
        timestamp: 1769150928,
        nonce: 1117922,
        index: 605,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff4df221439205aaaadb59e71b63c",
        previousHash: "fffff185fb24b425891ea775a8338729",
        player: "TIM",
        team: "TST",
        timestamp: 1769150947,
        nonce: 1795946,
        index: 606,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff5ca31ef21ac97a451ec2a209854",
        previousHash: "fffff4df221439205aaaadb59e71b63c",
        player: "TIM",
        team: "TST",
        timestamp: 1769150947,
        nonce: 88573,
        index: 607,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff54cdfb496d72d26d8a40a983aa3",
        previousHash: "fffff5ca31ef21ac97a451ec2a209854",
        player: "TIM",
        team: "TST",
        timestamp: 1769150952,
        nonce: 1358383,
        index: 608,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff51db9f36925dd2ad0a616b06ac3",
        previousHash: "fffff54cdfb496d72d26d8a40a983aa3",
        player: "TIM",
        team: "TST",
        timestamp: 1769150958,
        nonce: 1410863,
        index: 609,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff55030fb1c4163721640669dc9da",
        previousHash: "fffff51db9f36925dd2ad0a616b06ac3",
        player: "TIM",
        team: "TST",
        timestamp: 1769150965,
        nonce: 1473491,
        index: 610,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff3ca63914c18bddecf6499b23cef",
        previousHash: "fffff55030fb1c4163721640669dc9da",
        player: "TIM",
        team: "TST",
        timestamp: 1769150973,
        nonce: 937082,
        index: 611,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff89412382bb1e8daa89d9005075a",
        previousHash: "fffff3ca63914c18bddecf6499b23cef",
        player: "TIM",
        team: "TST",
        timestamp: 1769150984,
        nonce: 1534155,
        index: 612,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff93598e94400c31f1a2a6478c5db",
        previousHash: "fffff89412382bb1e8daa89d9005075a",
        player: "TIM",
        team: "TST",
        timestamp: 1769150984,
        nonce: 111161,
        index: 613,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffdf1872abd495fdaee353233f827",
        previousHash: "fffff93598e94400c31f1a2a6478c5db",
        player: "TIM",
        team: "TST",
        timestamp: 1769151046,
        nonce: 5623426,
        index: 614,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff86fe882e0e2ff88469f627d37a1",
        previousHash: "fffffdf1872abd495fdaee353233f827",
        player: "TIM",
        team: "TST",
        timestamp: 1769151051,
        nonce: 760227,
        index: 615,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff2d147e272484920bf8d1d6861af",
        previousHash: "fffff86fe882e0e2ff88469f627d37a1",
        player: "TIM",
        team: "TST",
        timestamp: 1769151053,
        nonce: 344995,
        index: 616,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff4a9b6fdc58192676ae6095b7346",
        previousHash: "fffff2d147e272484920bf8d1d6861af",
        player: "TIM",
        team: "TST",
        timestamp: 1769151064,
        nonce: 1968742,
        index: 617,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffeafe683b295b7f9630fcd8ad0af",
        previousHash: "fffff4a9b6fdc58192676ae6095b7346",
        player: "TIM",
        team: "TST",
        timestamp: 1769151069,
        nonce: 1265745,
        index: 618,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffc3e7dec50b62cfb2f9bec0eaba8",
        previousHash: "fffffeafe683b295b7f9630fcd8ad0af",
        player: "TIM",
        team: "TST",
        timestamp: 1769151070,
        nonce: 113048,
        index: 619,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffa8bd6c6baddb8f5d13e886a0fef",
        previousHash: "fffffc3e7dec50b62cfb2f9bec0eaba8",
        player: "TIM",
        team: "TST",
        timestamp: 1769151073,
        nonce: 984439,
        index: 620,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff16ca1d3deb34d4ab0ae7db93324",
        previousHash: "fffffa8bd6c6baddb8f5d13e886a0fef",
        player: "TIM",
        team: "TST",
        timestamp: 1769151082,
        nonce: 1124652,
        index: 621,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff522f601953b6c5ac67d011555a4",
        previousHash: "fffff16ca1d3deb34d4ab0ae7db93324",
        player: "TIM",
        team: "TST",
        timestamp: 1769151099,
        nonce: 2384766,
        index: 622,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff56ae6764b4f7f382d85ce4c45a9",
        previousHash: "fffff522f601953b6c5ac67d011555a4",
        player: "TIM",
        team: "TST",
        timestamp: 1769151118,
        nonce: 2032962,
        index: 623,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff0b50e41c81fedd89afd6f8b6091",
        previousHash: "fffff56ae6764b4f7f382d85ce4c45a9",
        player: "TIM",
        team: "TST",
        timestamp: 1769151119,
        nonce: 931360,
        index: 624,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffb243e2aeb93061840f24189f4e0",
        previousHash: "fffff0b50e41c81fedd89afd6f8b6091",
        player: "TIM",
        team: "TST",
        timestamp: 1769151131,
        nonce: 1317153,
        index: 625,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff2da4c131a28a9585c62830be87d",
        previousHash: "fffffb243e2aeb93061840f24189f4e0",
        player: "TIM",
        team: "TST",
        timestamp: 1769151132,
        nonce: 932066,
        index: 626,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff5b3f3e9e31c29dfbfec57c11652",
        previousHash: "fffff2da4c131a28a9585c62830be87d",
        player: "TIM",
        team: "TST",
        timestamp: 1769151135,
        nonce: 784767,
        index: 627,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff084c1d8169bbba149e352952aa4",
        previousHash: "fffff5b3f3e9e31c29dfbfec57c11652",
        player: "TIM",
        team: "TST",
        timestamp: 1769151147,
        nonce: 1573434,
        index: 628,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "ffffffe02255ee189dee037b20af8cf7",
        previousHash: "fffff084c1d8169bbba149e352952aa4",
        player: "TIM",
        team: "TST",
        timestamp: 1769151152,
        nonce: 554329,
        index: 629,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff4fb1ae5d400ef0bd0a71e4b25a9",
        previousHash: "ffffffe02255ee189dee037b20af8cf7",
        player: "TIM",
        team: "TST",
        timestamp: 1769151197,
        nonce: 4413183,
        index: 630,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff0f52a5120f9328ed3cbc24372c7",
        previousHash: "fffff4fb1ae5d400ef0bd0a71e4b25a9",
        player: "TIM",
        team: "TST",
        timestamp: 1769151201,
        nonce: 559397,
        index: 631,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffed09fb24b396f1735163167a66d",
        previousHash: "fffff0f52a5120f9328ed3cbc24372c7",
        player: "TIM",
        team: "TST",
        timestamp: 1769151241,
        nonce: 4522316,
        index: 632,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffbf86b38db54c54d37b0e81786c5",
        previousHash: "fffffed09fb24b396f1735163167a66d",
        player: "TIM",
        team: "TST",
        timestamp: 1769151244,
        nonce: 460439,
        index: 633,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff490a793a6566b9c135423f7618d",
        previousHash: "fffffbf86b38db54c54d37b0e81786c5",
        player: "TIM",
        team: "TST",
        timestamp: 1769151250,
        nonce: 1147873,
        index: 634,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffc69afd41f664bc177ad4810432a",
        previousHash: "fffff490a793a6566b9c135423f7618d",
        player: "TIM",
        team: "TST",
        timestamp: 1769151252,
        nonce: 678029,
        index: 635,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff2d6520777536a6aeb2d470f87b4",
        previousHash: "fffffc69afd41f664bc177ad4810432a",
        player: "TIM",
        team: "TST",
        timestamp: 1769151293,
        nonce: 3800489,
        index: 636,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff31606a4659153c6f9f2d5a5f16a",
        previousHash: "fffff2d6520777536a6aeb2d470f87b4",
        player: "TIM",
        team: "TST",
        timestamp: 1769151307,
        nonce: 1910725,
        index: 637,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff3fc1612d53c87c6754c9b03725d",
        previousHash: "fffff31606a4659153c6f9f2d5a5f16a",
        player: "TIM",
        team: "TST",
        timestamp: 1769151310,
        nonce: 943758,
        index: 638,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff3b025fcd8194e9f632bd4c2027b",
        previousHash: "fffff3fc1612d53c87c6754c9b03725d",
        player: "TIM",
        team: "TST",
        timestamp: 1769151312,
        nonce: 756009,
        index: 639,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff49e8846c070ce5967f94f89751f",
        previousHash: "fffff3b025fcd8194e9f632bd4c2027b",
        player: "TIM",
        team: "TST",
        timestamp: 1769151318,
        nonce: 879189,
        index: 640,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff169880ddbba5a56b6370f4befcf",
        previousHash: "fffff49e8846c070ce5967f94f89751f",
        player: "TIM",
        team: "TST",
        timestamp: 1769151330,
        nonce: 1726606,
        index: 641,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff6b8314c74b1f1924c84d48fc490",
        previousHash: "fffff169880ddbba5a56b6370f4befcf",
        player: "TIM",
        team: "TST",
        timestamp: 1769151351,
        nonce: 2517603,
        index: 642,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff9570d39fccf442c67cebc79f5b1",
        previousHash: "fffff6b8314c74b1f1924c84d48fc490",
        player: "TIM",
        team: "TST",
        timestamp: 1769151356,
        nonce: 625326,
        index: 643,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff4f74ebdf5857a56a5661fd3ca57",
        previousHash: "fffff9570d39fccf442c67cebc79f5b1",
        player: "TIM",
        team: "TST",
        timestamp: 1769151363,
        nonce: 808725,
        index: 644,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff0a52bfc5a9c4f31c1db83c8e901",
        previousHash: "fffff4f74ebdf5857a56a5661fd3ca57",
        player: "TIM",
        team: "TST",
        timestamp: 1769151372,
        nonce: 1788386,
        index: 645,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff04ded67181fb37c892d123059d9",
        previousHash: "fffff0a52bfc5a9c4f31c1db83c8e901",
        player: "TIM",
        team: "TST",
        timestamp: 1769151401,
        nonce: 3227708,
        index: 646,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff3355d55ff173a0869c39b83e77a",
        previousHash: "fffff04ded67181fb37c892d123059d9",
        player: "TIM",
        team: "TST",
        timestamp: 1769151405,
        nonce: 574353,
        index: 647,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "ffffff99ca97d6846775a5353ea53cbc",
        previousHash: "fffff3355d55ff173a0869c39b83e77a",
        player: "TIM",
        team: "TST",
        timestamp: 1769151419,
        nonce: 1782273,
        index: 648,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff6512fd709ec12cb66f96b4c2a86",
        previousHash: "ffffff99ca97d6846775a5353ea53cbc",
        player: "TIM",
        team: "TST",
        timestamp: 1769151421,
        nonce: 285453,
        index: 649,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffbf4637d13c47a88a610082273b1",
        previousHash: "fffff6512fd709ec12cb66f96b4c2a86",
        player: "TIM",
        team: "TST",
        timestamp: 1769151426,
        nonce: 1394299,
        index: 650,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff7c38a08ac8f8d4d3b922e48559a",
        previousHash: "fffffbf4637d13c47a88a610082273b1",
        player: "TIM",
        team: "TST",
        timestamp: 1769151436,
        nonce: 1529398,
        index: 651,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff85e2b0f484ab1745ca05d50a024",
        previousHash: "fffff7c38a08ac8f8d4d3b922e48559a",
        player: "TIM",
        team: "TST",
        timestamp: 1769151442,
        nonce: 1440985,
        index: 652,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffaad69b87d66d2c82b43186c158b",
        previousHash: "fffff85e2b0f484ab1745ca05d50a024",
        player: "TIM",
        team: "TST",
        timestamp: 1769151449,
        nonce: 714301,
        index: 653,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff3b5eee2867a1560c57377fae9c2",
        previousHash: "fffffaad69b87d66d2c82b43186c158b",
        player: "TIM",
        team: "TST",
        timestamp: 1769151465,
        nonce: 1590654,
        index: 654,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffd948e04fbf3e1ded1d1b24a8278",
        previousHash: "fffff3b5eee2867a1560c57377fae9c2",
        player: "TIM",
        team: "TST",
        timestamp: 1769151468,
        nonce: 857400,
        index: 655,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff96bb3e89f4f45e38bd5d3364662",
        previousHash: "fffffd948e04fbf3e1ded1d1b24a8278",
        player: "TIM",
        team: "TST",
        timestamp: 1769151473,
        nonce: 481835,
        index: 656,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff1749eb0cbd029fa669e5822b8d5",
        previousHash: "fffff96bb3e89f4f45e38bd5d3364662",
        player: "TIM",
        team: "TST",
        timestamp: 1769151483,
        nonce: 1748426,
        index: 657,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff64e24e77f7df680adfddc3c4b5b",
        previousHash: "fffff1749eb0cbd029fa669e5822b8d5",
        player: "TIM",
        team: "TST",
        timestamp: 1769151493,
        nonce: 1281833,
        index: 658,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffab2999cbca99c73d8be95af0d2f",
        previousHash: "fffff64e24e77f7df680adfddc3c4b5b",
        player: "TIM",
        team: "TST",
        timestamp: 1769151499,
        nonce: 1471560,
        index: 659,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffb827abbe2131786a9dc00e6652c",
        previousHash: "fffffab2999cbca99c73d8be95af0d2f",
        player: "TIM",
        team: "TST",
        timestamp: 1769151499,
        nonce: 627673,
        index: 660,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff09987c2219eff2aba699972d992",
        previousHash: "fffffb827abbe2131786a9dc00e6652c",
        player: "TIM",
        team: "TST",
        timestamp: 1769151515,
        nonce: 1493503,
        index: 661,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffc7604921563817661d1ff3cb804",
        previousHash: "fffff09987c2219eff2aba699972d992",
        player: "TIM",
        team: "TST",
        timestamp: 1769151546,
        nonce: 3739921,
        index: 662,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff2bd647a80dab39d10188edd677a",
        previousHash: "fffffc7604921563817661d1ff3cb804",
        player: "TIM",
        team: "TST",
        timestamp: 1769151547,
        nonce: 589742,
        index: 663,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff38bdef394f10a7b37c7a5bd1fd1",
        previousHash: "fffff2bd647a80dab39d10188edd677a",
        player: "TIM",
        team: "TST",
        timestamp: 1769151576,
        nonce: 2887551,
        index: 664,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff72f74383c9a9f46d8bc70106fa4",
        previousHash: "fffff38bdef394f10a7b37c7a5bd1fd1",
        player: "TIM",
        team: "TST",
        timestamp: 1769151585,
        nonce: 1507226,
        index: 665,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff12bfa889d5e1934b4ecca0853f6",
        previousHash: "fffff72f74383c9a9f46d8bc70106fa4",
        player: "TIM",
        team: "TST",
        timestamp: 1769151597,
        nonce: 1490009,
        index: 666,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff20e1377f3900df2c988686d9dd9",
        previousHash: "fffff12bfa889d5e1934b4ecca0853f6",
        player: "TIM",
        team: "TST",
        timestamp: 1769151629,
        nonce: 3631083,
        index: 667,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffae79203c473f9d476d5236d3354",
        previousHash: "fffff20e1377f3900df2c988686d9dd9",
        player: "TIM",
        team: "TST",
        timestamp: 1769151641,
        nonce: 1134420,
        index: 668,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffa6ecac6e96a256a8e584fedd29a",
        previousHash: "fffffae79203c473f9d476d5236d3354",
        player: "TIM",
        team: "TST",
        timestamp: 1769151653,
        nonce: 1270809,
        index: 669,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffb1a7e1e0d767943fb07ee46249e",
        previousHash: "fffffa6ecac6e96a256a8e584fedd29a",
        player: "TIM",
        team: "TST",
        timestamp: 1769151657,
        nonce: 1222928,
        index: 670,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff4da3c8c8c48834ce8cc535da9e8",
        previousHash: "fffffb1a7e1e0d767943fb07ee46249e",
        player: "TIM",
        team: "TST",
        timestamp: 1769151667,
        nonce: 1576059,
        index: 671,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffed2285d9739df1bf924c90b11cb",
        previousHash: "fffff4da3c8c8c48834ce8cc535da9e8",
        player: "TIM",
        team: "TST",
        timestamp: 1769151695,
        nonce: 3544059,
        index: 672,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "ffffff98d7b1bf43145720f44c7d8b3c",
        previousHash: "fffffed2285d9739df1bf924c90b11cb",
        player: "TIM",
        team: "TST",
        timestamp: 1769151713,
        nonce: 1939250,
        index: 673,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff3917487a4aeb0e18fd5fdf9a4eb",
        previousHash: "ffffff98d7b1bf43145720f44c7d8b3c",
        player: "TIM",
        team: "TST",
        timestamp: 1769151718,
        nonce: 663643,
        index: 674,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "ffffff0172d7ebe6d68ee2930fbf6a85",
        previousHash: "fffff3917487a4aeb0e18fd5fdf9a4eb",
        player: "TIM",
        team: "TST",
        timestamp: 1769151734,
        nonce: 1959928,
        index: 675,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffc03f078b5c0413d1f5370156179",
        previousHash: "ffffff0172d7ebe6d68ee2930fbf6a85",
        player: "TIM",
        team: "TST",
        timestamp: 1769151736,
        nonce: 924432,
        index: 676,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff40f758b2360c40cfda1723513ce",
        previousHash: "fffffc03f078b5c0413d1f5370156179",
        player: "TIM",
        team: "TST",
        timestamp: 1769151742,
        nonce: 613909,
        index: 677,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff2025b07f887243bf7d95a3df73e",
        previousHash: "fffff40f758b2360c40cfda1723513ce",
        player: "TIM",
        team: "TST",
        timestamp: 1769151756,
        nonce: 1359501,
        index: 678,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "ffffffc7fa905973a3fd7169989c5d99",
        previousHash: "fffff2025b07f887243bf7d95a3df73e",
        player: "TIM",
        team: "TST",
        timestamp: 1769151773,
        nonce: 2512912,
        index: 679,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffbab5dbb48e031e9f7f0dbbfb29c",
        previousHash: "ffffffc7fa905973a3fd7169989c5d99",
        player: "TIM",
        team: "TST",
        timestamp: 1769151793,
        nonce: 2377133,
        index: 680,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff4a68b32813cde6451b87be189fe",
        previousHash: "fffffbab5dbb48e031e9f7f0dbbfb29c",
        player: "TIM",
        team: "TST",
        timestamp: 1769151796,
        nonce: 602712,
        index: 681,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff952a5e0ec318c922ce932078293",
        previousHash: "fffff4a68b32813cde6451b87be189fe",
        player: "TIM",
        team: "TST",
        timestamp: 1769151799,
        nonce: 818941,
        index: 682,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffda4aa074ce6ab52e3f1f1cb7ddf",
        previousHash: "fffff952a5e0ec318c922ce932078293",
        player: "TIM",
        team: "TST",
        timestamp: 1769151802,
        nonce: 934168,
        index: 683,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff41ccada1ff4792bb23d29761be6",
        previousHash: "fffffda4aa074ce6ab52e3f1f1cb7ddf",
        player: "TIM",
        team: "TST",
        timestamp: 1769151824,
        nonce: 2579023,
        index: 684,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff09f0282504af0221ebe7011d0ee",
        previousHash: "fffff41ccada1ff4792bb23d29761be6",
        player: "TIM",
        team: "TST",
        timestamp: 1769151865,
        nonce: 3851925,
        index: 685,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff7e275ca6e6f528314fd88e6e26b",
        previousHash: "fffff09f0282504af0221ebe7011d0ee",
        player: "TIM",
        team: "TST",
        timestamp: 1769151866,
        nonce: 864908,
        index: 686,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff9c1469e9f6223b69b7a6dd7dd60",
        previousHash: "fffff7e275ca6e6f528314fd88e6e26b",
        player: "TIM",
        team: "TST",
        timestamp: 1769151868,
        nonce: 823016,
        index: 687,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffd5a5e2ef638e390139f387c3b5c",
        previousHash: "fffff9c1469e9f6223b69b7a6dd7dd60",
        player: "TIM",
        team: "TST",
        timestamp: 1769151876,
        nonce: 792764,
        index: 688,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffd61c02ce0a16a53ed3ddf60d380",
        previousHash: "fffffd5a5e2ef638e390139f387c3b5c",
        player: "TIM",
        team: "TST",
        timestamp: 1769151881,
        nonce: 1459128,
        index: 689,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff77236de8d5db240ab72d3fee4d7",
        previousHash: "fffffd61c02ce0a16a53ed3ddf60d380",
        player: "TIM",
        team: "TST",
        timestamp: 1769151893,
        nonce: 1122553,
        index: 690,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff68e50e3833d037293c567750f64",
        previousHash: "fffff77236de8d5db240ab72d3fee4d7",
        player: "TIM",
        team: "TST",
        timestamp: 1769151897,
        nonce: 1328451,
        index: 691,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffd12cc25298adc230913ab1ee7f9",
        previousHash: "fffff68e50e3833d037293c567750f64",
        player: "TIM",
        team: "TST",
        timestamp: 1769151898,
        nonce: 1050935,
        index: 692,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff76718095c73918fd258b6fb5961",
        previousHash: "fffffd12cc25298adc230913ab1ee7f9",
        player: "TIM",
        team: "TST",
        timestamp: 1769151908,
        nonce: 1828408,
        index: 693,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff146b63f826e782a40ab79689668",
        previousHash: "fffff76718095c73918fd258b6fb5961",
        player: "TIM",
        team: "TST",
        timestamp: 1769151920,
        nonce: 1401039,
        index: 694,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff28c7779f8882aaffcda6ff8121f",
        previousHash: "fffff146b63f826e782a40ab79689668",
        player: "TIM",
        team: "TST",
        timestamp: 1769151944,
        nonce: 2881781,
        index: 695,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff83f65c6a60d43b39e9f82a9da59",
        previousHash: "fffff28c7779f8882aaffcda6ff8121f",
        player: "TIM",
        team: "TST",
        timestamp: 1769151947,
        nonce: 1217708,
        index: 696,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffc8bd5e1ad5c40cabe9f512ed0d4",
        previousHash: "fffff83f65c6a60d43b39e9f82a9da59",
        player: "TIM",
        team: "TST",
        timestamp: 1769151950,
        nonce: 1028749,
        index: 697,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "ffffffe50dc6bc7e7cdf2a0a443b612b",
        previousHash: "fffffc8bd5e1ad5c40cabe9f512ed0d4",
        player: "TIM",
        team: "TST",
        timestamp: 1769151950,
        nonce: 341515,
        index: 698,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffaf3b3892a72b737948c9d66f57c",
        previousHash: "ffffffe50dc6bc7e7cdf2a0a443b612b",
        player: "TIM",
        team: "TST",
        timestamp: 1769151952,
        nonce: 716662,
        index: 699,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffdc3bfe4432e5ea3bb30bb095a60",
        previousHash: "fffffaf3b3892a72b737948c9d66f57c",
        player: "TIM",
        team: "TST",
        timestamp: 1769151961,
        nonce: 1846600,
        index: 700,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff494c29d03801baf7a12197ab989",
        previousHash: "fffffdc3bfe4432e5ea3bb30bb095a60",
        player: "TIM",
        team: "TST",
        timestamp: 1769151969,
        nonce: 1496018,
        index: 701,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffbbb5dca678183aad10bbb3fbd87",
        previousHash: "fffff494c29d03801baf7a12197ab989",
        player: "TIM",
        team: "TST",
        timestamp: 1769152008,
        nonce: 4409455,
        index: 702,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff37af9f6a4c4ec63df567c16d63a",
        previousHash: "fffffbbb5dca678183aad10bbb3fbd87",
        player: "TIM",
        team: "TST",
        timestamp: 1769152043,
        nonce: 3618577,
        index: 703,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffd8ed7b84aea5fa9f30398d47e8e",
        previousHash: "fffff37af9f6a4c4ec63df567c16d63a",
        player: "TIM",
        team: "TST",
        timestamp: 1769152048,
        nonce: 766804,
        index: 704,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffb24dff12fc8717a029b942f8e82",
        previousHash: "fffffd8ed7b84aea5fa9f30398d47e8e",
        player: "TIM",
        team: "TST",
        timestamp: 1769152063,
        nonce: 1610055,
        index: 705,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffbb1cd7edeaeb65b246108d35ff8",
        previousHash: "fffffb24dff12fc8717a029b942f8e82",
        player: "TIM",
        team: "TST",
        timestamp: 1769152066,
        nonce: 886993,
        index: 706,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffbec90b60c51423df20cb902178a",
        previousHash: "fffffbb1cd7edeaeb65b246108d35ff8",
        player: "TIM",
        team: "TST",
        timestamp: 1769152071,
        nonce: 1371300,
        index: 707,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffff71274da69b245bab95936ef0df0",
        previousHash: "fffffbec90b60c51423df20cb902178a",
        player: "TIM",
        team: "TST",
        timestamp: 1769152097,
        nonce: 3448281,
        index: 708,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffe9af7011d11db8012da83f25e22",
        previousHash: "fffff71274da69b245bab95936ef0df0",
        player: "TIM",
        team: "TST",
        timestamp: 1769152103,
        nonce: 1141895,
        index: 709,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "fffffc91d5d3b04ce1e25dcd7e0e3ec9",
        previousHash: "fffffe9af7011d11db8012da83f25e22",
        player: "TIM",
        team: "TST",
        timestamp: 1769152113,
        nonce: 1017942,
        index: 710,
        identity: "bb63088010ba04bc",
      },
      {
        hash: "ffffff803beca289461c1c5e56bcd40e",
        previousHash: "fffffc91d5,d3b04ce1e25dcd7e0e3ec9",
        player: "TIM",
        team: "TST",
        timestamp: 1769152124,
        nonce: 1729114,
        index: 711,
        identity: "bb63088010ba04bc",
      },
    ];

    it("can get the most recent difficulty slice from a chain", () => {
      const difficultySlice =
        Difficulty.getDifficultySliceFromChain(chainSubset);
      expect(difficultySlice.length).toBe(100);
      expect(difficultySlice[0].index).toBe(601);
      expect(difficultySlice[99].index).toBe(700);
    });

    it("can get the average mining interval of the difficulty slice", () => {
      const difficultySlice =
        Difficulty.getDifficultySliceFromChain(chainSubset);
      const averageMiningInterval =
        Chain.getAverageMiningInterval(difficultySlice);
      expect(averageMiningInterval).toBeCloseTo(
        (1769151961 - 1769150864) / 100,
      );
    });

    it("can get the average difficulty of the difficulty slice", () => {
      const difficultySlice =
        Difficulty.getDifficultySliceFromChain(chainSubset);
      const averageDifficulty =
        Difficulty.getAverageDifficulty(difficultySlice);
      expect(averageDifficulty).toBeGreaterThan(5);
      expect(averageDifficulty).toBeLessThan(6);
    });

    it("returns an empty array if the chain is less than 100 blocks", () => {
      const difficultySlice = Difficulty.getDifficultySliceFromChain(
        chainSubset.slice(0, 99),
      );
      expect(difficultySlice.length).toBe(0);
    });

    it("returns an empty array if there is no previous indexes that work", () => {
      const leftIndex = chainSubset.findIndex((block) => block.index === 586);
      const rightIndex = chainSubset.findIndex((block) => block.index === 695);
      const slice = chainSubset.slice(leftIndex, rightIndex);
      const difficultySlice = Difficulty.getDifficultySliceFromChain(slice);
      expect(difficultySlice.length).toBe(0);
    });
  });

  describe("isDifficultyMet", () => {
    it("Can check if a hash meets a difficulty target", () => {
      const difficultyTarget = "fffffffff10000000000000000000000";
      const hash = "fffffffffce67ad6b81718943f17c5eb";
      const isMet = Difficulty.isDifficultyMet(hash, difficultyTarget);
      expect(isMet).toBe(true);
    });

    it("Can check if a hash does not meet a difficulty target", () => {
      const difficultyTarget = "ffffffffffc000000000000000000000";
      const hash = "fffffffff1ce67ad6b81718943f17c5eb";
      const isMet = Difficulty.isDifficultyMet(hash, difficultyTarget);
      expect(isMet).toBe(false);
    });
  });
});
